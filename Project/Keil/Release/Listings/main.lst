C51 COMPILER V9.60.7.0   MAIN                                                              09/08/2025 11:52:53 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Release\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\main.c LARGE OPTIMIZE(8,SPEED) BROWSE INTVECTOR(0X000C) INCDI
                    -R(..\..\Libraries\Include;..\..\User) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\main.lst) OBJECT(.\Release
                    -\Objects\main.obj)

line level    source

   1          
   2          
   3          #include "include.h"
   4          #include <stdio.h>
   5          #include "main.h"
   6          #include <math.h>
   7          /** @addtogroup Template_Project
   8           * @{
   9           */
  10          
  11          /* Private typedef -----------------------------------------------------------*/
  12          /* Private define ------------------------------------------------------------*/
  13          /* Private macro -------------------------------------------------------------*/
  14          /* Private variables ---------------------------------------------------------*/
  15          
  16          LED_S led_state;
  17          /* Private function prototypes -----------------------------------------------*/
  18          /* Private functions ---------------------------------------------------------*/
  19          
  20          /*
  21              åœ¨å¼€æœºç¼“å¯åŠ¨æœŸé—´ï¼Œè´Ÿè´£æ§åˆ¶å ç©ºæ¯”è°ƒèŠ‚æ—¶é—´
  22          */
  23          volatile u8 adjust_pwm_during_pwr_on = 0;
  24          volatile double pwr_on_step = 0.0; // å¼€æœºç¼“å¯åŠ¨çš„æ­¥é•¿
  25          
  26          // volatile u8 user_debug_ms_cnt = 0; // æµ‹è¯•ç”¨
  27          
  28          /*********************************
  29          |--------------------------------|
  30          | ä½¿ç”¨%dæ‰“å°çš„æ•°å€¼ä¸å¯¹æ—¶ï¼Œè¯·æ³¨æ„ |
  31          |--------------------------------|
  32          | æ ¼å¼ |     å«ä¹‰     | é’ˆå¯¹ç±»å‹ |
  33          |------|--------------|----------|
  34          | %bd  | å•ä¸ªå­—èŠ‚å˜é‡ | char     |
  35          | % d  | ä¸¤ä¸ªå­—èŠ‚å˜é‡ | int      |
  36          | %ld  | å››ä¸ªå­—èŠ‚å˜é‡ | long int |
  37          |--------------------------------|
  38          **********************************/
  39          // é‡å†™puchar()å‡½æ•°,ç”¨äºæ ‡å‡†printf()å‡½æ•° (æ³¨æ„:ä½¿ç”¨printf()å‡½æ•°å ç”¨1kå·¦å³çš„codeç©ºé—´
             -)
  40          char putchar(char c)
  41          {
  42   1          debug_putchar(c);
  43   1      
  44   1          return c;
  45   1      }
  46          
  47          /**
  48           * @brief  Main program.
  49           * @param  None
  50           * @retval None
  51           */
  52          extern void timer4_cap_init(void);
C51 COMPILER V9.60.7.0   MAIN                                                              09/08/2025 11:52:53 PAGE 2   

  53          extern void timer0_init();
  54          extern void get_duty(void);
  55          extern void pwm_init(void);
  56          extern void option_fun(void);
  57          extern void init_lvd_4V(void);
  58          extern void init_lvd_3v(void);
  59          
  60          extern void lvd_handler(void);
  61          extern void adc_init();
  62          extern void adc_val();
  63          extern u16 ntc_val;
  64          extern u16 adjust_val;
  65          extern u16 ajust_duty;
  66          extern u16 adc0_val;
  67          extern u16 adc1_val;
  68          extern void adjust_pwm();
  69          extern u16 max_duty;
  70          extern u32 pwm_in_duty;
  71          extern bit dly_pwr_on;
  72          extern u8 simple_over;
  73          extern u16 max_duty;
  74          void main(void)
  75          {
  76   1      
  77   1          system_init();
  78   1      
  79   1          //  P1_MD1   &= ~GPIO_P15_MODE_SEL(0x03);
  80   1          //  P1_MD1   |=  GPIO_P15_MODE_SEL(0x01);
  81   1          //  P1_PU |= GPIO_P15_PULL_UP(1);
  82   1          //  P15 = 1;
  83   1      
  84   1          //  P1_MD1   &= ~GPIO_P16_MODE_SEL(0x03);
  85   1          //  P1_MD1   |=  GPIO_P16_MODE_SEL(0x01);
  86   1          //  P1_PU |= GPIO_P16_PULL_UP(1);
  87   1          //  P16 = 1;
  88   1          //          while(1)
  89   1          //    {
  90   1          //      WDT_KEY = WDT_KEY_VAL(0xAA);        // å–‚ç‹—å¹¶æ¸…é™¤ wdt_pending
  91   1          //          }
  92   1      
  93   1          //  delay_ms(5);
  94   1      #if 1
  95   1          // çœ‹é—¨ç‹—é»˜è®¤æ‰“å¼€, å¤ä½æ—¶é—´2s
  96   1          //    WDT_KEY = WDT_KEY_VAL(0xDD);               //  å…³é—­çœ‹é—¨ç‹— (å¦‚éœ€é…ç½®çœ‹é—¨ç‹—è¯·æŸ¥çœ‹â€
             -œWDT\WDT_Resetâ€ç¤ºä¾‹)
  97   1          led_state = LED_PWR_ON;
  98   1      
  99   1          delay_ms(10);
 100   1          // åˆå§‹åŒ–æ‰“å°
 101   1          debug_init();
 102   1          user_printf("TX8C126x_SDK main start\n");
 103   1          timer4_cap_init();
 104   1      
 105   1          __SetIRQnIP(TMR4_IRQn, TMR4_IQn_CFG);
 106   1          __SetIRQnIP(STMR0_IRQn, STMR0_IQn_CFG);
 107   1      
 108   1          timer0_init();
 109   1          pwm_init();
 110   1          adc_init();
 111   1          adc_val(); // åˆå§‹åŒ–æ—¶è¿è¡Œä¸€æ¬¡ï¼Œç”¨äºæ ‡å¿—ä½åˆ¤æ–­
 112   1          option_fun();
 113   1          printf("adc0_val = %d  adc1_val = %d \r\n ", adc0_val, adc1_val);
C51 COMPILER V9.60.7.0   MAIN                                                              09/08/2025 11:52:53 PAGE 3   

 114   1          init_lvd_3v();
 115   1          while (1)
 116   1          {
 117   2              WDT_KEY = WDT_KEY_VAL(0xAA); // å–‚ç‹—å¹¶æ¸…é™¤ wdt_pending
 118   2              get_duty();
 119   2              lvd_handler();
 120   2              // adc_val();//adcå€¼
 121   2              adjust_pwm(); // ç”µä½å™¨å€¼
 122   2      
 123   2              // printf("main\n"); // æµ‹è¯•æœ‰æ²¡æœ‰å¡æ­»çš„æƒ…å†µ
 124   2                            
 125   2              // dly_pwr_on =1;
 126   2          }
 127   1      #endif
 128   1      }
 129          
 130          /**
 131           * @}
 132           */
 133          
 134          /*************************** (C) COPYRIGHT 2021 HUGE-IC ***** END OF FILE *****/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    132    ----
   CONSTANT SIZE    =     58    ----
   XDATA SIZE       =      6       1
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
